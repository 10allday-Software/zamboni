{% extends 'developers/base_impala.html' %}
{% from 'developers/includes/macros.html' import required, tip %}

{% set title = _('Content Ratings') %}
{% block title %}{{ hub_page_title(title, addon) }}{% endblock %}

{% block content %}
  <header>
    {% if addon.is_rated() %}
      {{ hub_breadcrumbs(
             addon, items=[(addon.get_dev_url('ratings'), _('Content Ratings')),
                           (None, _('Edit'))]) }}
    {% else %}
      {# For unrated apps, there is only the Edit page. No summary page. #}
      {{ hub_breadcrumbs(addon, items=[(None, _('Content Ratings'))]) }}
    {% endif %}
    <h1>{{ title }}</h1>
  </header>

  <section id="ratings-edit" class="primary manage">
    <section class="create-rating">
      <h2>{{ _('Get My App Rated') }}</h2>

      <div class="island">
        {% if addon.is_rated() %}
        <p>
          {% trans %}
            Your app has already been age rated and has an
            International Age Rating Coalition (IARC) certificate attached. To
            change the rating, click on the button below: that will open a new
            window where you can fill out a new questionnaire about the
            contents of your app. Upon completion, the window will close and
            your app will then have an new age rating and certificate.
          {% endtrans %}
        </p>
        {% else %}
        <p>
          {% trans %}
            To have your app listed on the Marketplace, you must attain an
            International Age Rating Coalition (IARC) certificate. Clicking on
            the button below will open a new window where you can fill out a
            short yes-or-no questionnaire about the contents of your app. Upon
            completion, the window will close and your app will then have an age
            rating.
          {% endtrans %}
        </p>
        {% endif %}
        <p>
          {% trans privacy_url=settings.IARC_PRIVACY_URL, tos_url=settings.IARC_TOS_URL %}
            By using the IARC ratings certificate tool, you agree to abide by their
            <a href="{{ privacy_url }}">Privacy Policy</a> and
            <a href="{{ tos_url }}">Terms of Service agreement</a>.
          {% endtrans %}
        </p>
        <p class="done hidden">
          {% trans ratings_url=addon.get_dev_url('ratings') %}
            IARC content rating process complete, you will be redirected to
            your app's <a href="{{ ratings_url }}">content ratings page</a>.
          {% endtrans %}
        </p>
        <p class="error hidden">
          {% trans %}
            Sorry, there was an error on our side processing content ratings.
            You can keep trying or try again later.
          {% endtrans %}
        </p>
        <form id="iarc" method="get" action="{{ settings.IARC_V2_SUBMISSION_ENDPOINT }}"
              target="IARCForm">
          <input type="hidden" name="StoreID" value="{{ settings.IARC_V2_STORE_ID }}">
          <input type="hidden" name="StoreRequestID" value="{{ iarc_request_id }}">
          <input type="hidden" name="LanguageID" value="{{ request.LANG }}">
          <p class="listing-footer">
            <button type="submit" class="create-iarc-rating button"
                    data-api-url="{{ url('content-ratings-list', addon.app_slug)|urlparams(since=now) }}"
                    data-redirect-url="{{ addon.get_dev_url('ratings') }}">
              {{ _('Create an IARC Ratings Certificate') }}</button>
          </p>
        </form>
      </div>
    </section>

    <section>
      <h2>
        {{ _('Already Have an IARC Certificate?') }}
      </h2>

      <div class="island">
        <p>
          {% trans %}
            If you have already gotten your app rated via the IARC Global
            Ratings Tool above and already have an IARC certificate, you can
            enter it here and we'll notify IARC to link your Marketplace
            submission with that certificate.
          {% endtrans %}
        </p>
        {% if addon.is_rated() %}
          <p>
            {% trans %}
              Warning: if a certificate is already attached to your app, this
              will overwrite it. Use with caution.
            {% endtrans %}
          </p>
        {% endif %}
        <form method="POST">
          {{ csrf() }}
          <div class="iarc-cert">
            <label for="{{ form.cert_id.auto_id }}">
              {{ _('Certificate ID') }}
              {{ required() }}
              {{ form.cert_id }}
            </label>
                {{ tip(None,
                       _("The certificate ID is an unique identifier sent "
                         "to you. It is a mix of letters, numbers and "
                         "dashes following the UUID canonical hexadecimal "
                         "format like "
                         "&quot;adb3261b-c657-4fd2-a057-bc9f85310b80&quot;."
                        )) }}
            {{ form.cert_id.errors }}
          </div>
          {{ form.non_field_errors() }}
          <p class="listing-footer">
            <button>{{ _('Submit') }}</button>
          </p>
        </form>
      </div>
    </section>
  </section>

  {% include 'developers/includes/addons_edit_nav.html' %}
{% endblock %}
